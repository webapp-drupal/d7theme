/**
 * @license ev-em.js v3.2.15
 * (c) 2015-2019 Evolok, Inc. http://www.evolok.com/
 *
 * License: MIT
 */
window.EV=window.EV||{},function(t){"use strict";function n(){g&&o("ev_sid")!=g&&(s("ev_sid",g,10),c("ev_sid",g,0,"localStorage"),p=p+"&ev_sid="+g),m&&o("ev_did")!=m&&(s("ev_did",m,10),c("ev_did",m,0,"localStorage"),p=p+"&ev_did="+m)}function o(e){var t,n="; "+document.cookie,o=n.split("; "+e+"=");return 2==o.length?(t=o.pop().split(";").shift(),t=t.replace(/["'()]/g,"")):""}function s(e,t,n){if(!f.sidCookieDomain)throw new Error("Please specify sidCookieDomain in the config!",!0);var o=new Date;n=1460,o.setDate(o.getDate()+n),document.cookie=e+"="+escape(t)+(null===n?"":";expires="+o.toUTCString())+";path=/; domain="+f.sidCookieDomain,console.log(e+"="+escape(t)+(null===n?"":";expires="+o.toUTCString())+";path=/; domain="+f.sidCookieDomain)}function r(e){if(""!==o(e)&&"undefined"!==o(e))return o(e)}function i(e){if(""!==d(e,"localStorage")&&"undefined"!==d(e,"localStorage"))return d(e,"localStorage")}function a(){if(!f)throw"Evolok Metering library is not initialised!"}function d(e,t){var n=document.cookie.indexOf(e+"=");if("localStorage"==t){if("undefined"==typeof localStorage)return document.cookie.length>0&&-1!==n?getCookieSubstring(n,e):"";try{return localStorage.getItem(e)}catch(e){return console.warn("Could not retrieve the cookie in local storage - maybe the browser's running on an environment with restricted access to localStorage?"),"undefined"}}if("sessionStorage"==t){if("undefined"==typeof sessionStorage)return n=document.cookie.indexOf(e+"="),document.cookie.length>0&&-1!==n?getCookieSubstring(n,e):"";console.log(sessionStorage.getItem(e));try{return sessionStorage.getItem(e)}catch(e){return console.warn("Could not retrieve the cookie in session storage - maybe the browser's running on an environment with restricted access to sessionStorage?"),"undefined"}}}function c(e,t,n,o){var s=new Date;if("localStorage"==o)if(s.setDate(s.getDate()+n),"undefined"!=typeof localStorage)try{localStorage.setItem(e,t)}catch(e){console.warn("Could not store the cookie in local storage - maybe the browser's running on an environment with restricted access to localStorage?")}else document.cookie=e+"="+escape(t)+(null===n?"":";expires="+s.toUTCString());if("sessionStorage"==o)if(s.setDate(s.getDate()+n),"undefined"!=typeof sessionStorage)try{sessionStorage.setItem(e,t)}catch(e){console.warn("Could not store the cookie in session storage - maybe the browser's running on an environment with restricted access to sessionStorage?")}else document.cookie=e+"="+escape(t)+(null===n?"":";expires="+s.toUTCString())}function l(e){var t="";e=JSON.parse(e);for(var n in e)""!==t&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]);return t}function u(e,t){a();var n=f.url;if(!n)throw new Error("Evolok Metering host url is not configured!");return"/"===n.charAt(n.length-1)&&"/"===e.charAt(0)?n+=e.substring(1,e.length):n+=e,n=t?n+"?"+t:n}function v(){var e=this;this.promise=new Promise(function(t,n){e.reject=n,e.resolve=t})}var f,g,m,p,h,_=new v,w=new v;t.Em={init:function(e){if(!e.url)throw"Configuration must specify the url property!";f=e},getAuthResponse:function(){return _.promise},getSegmentResponse:function(){return w.promise},authorize:function(e,n,a){t.Em.assert(e,"Parameters should not be empty!"),t.Em.assert(n,"Success callback should not be empty!"),t.Em.assert(a,"Error callback should not be empty!");var v=l(e),w="",S="",y="";p=v,-1===v.indexOf("referrer")&&document.referrer&&(v+="&referrer="+encodeURIComponent(document.referrer)),-1===v.indexOf("title")&&document.title&&(v+="&title="+encodeURIComponent(document.title)),r("ev_sid")?(S="&ev_sid="+o("ev_sid"),c("ev_sid",o("ev_sid"),0,"localStorage")):i("ev_sid")&&(f.meterHD?!0===f.meterHD&&(s("ev_sid",d("ev_sid","localStorage"),10),S="&ev_sid="+d("ev_sid","localStorage"),h=f.meterHD):s("ev_sid",d("ev_sid","localStorage"),10)),r("ev_did")?(y="&ev_did="+o("ev_did"),c("ev_did",o("ev_did"),0,"localStorage")):i("ev_did")&&(f.meterHD?!0===f.meterHD&&(s("ev_did",d("ev_did","localStorage"),10),y="&ev_did="+d("ev_did","localStorage")):s("ev_did",d("ev_did","localStorage"),10)),""!==o("ev_ss")&&(w+="&ev_ss="+o("ev_ss")),w=w==="&ev_ss="+o("ev_ss")?"&ev_ss="+o("ev_ss"):"&ev_ss=",S=S==="&ev_sid="+o("ev_sid")?"&ev_sid="+o("ev_sid"):"&ev_sid=",y=y==="&ev_did="+o("ev_did")?"&ev_did="+o("ev_did"):"&ev_did=",v=v+w+S+y;var E=u("/authorize/json",v),C=new XMLHttpRequest;C.open("GET",E,!0),C.withCredentials=!0,C.onload=function(){if(C.status>=200&&C.status<400){var e=JSON.parse(C.responseText);_.resolve(e),function(e){function t(e){var t;"function"==typeof CustomEvent?t=new CustomEvent("ev.ad.authorize",{detail:e}):(t=document.createEvent("CustomEvent"),t.initCustomEvent("ev.ad.authorize",!1,!1,e)),window.dispatchEvent(t)}t(e),window.addEventListener("ev.widgets.paywall.load",function(){t(e)}),window.addEventListener("ev.widgets.notifier.load",function(){t(e)})}(e),e.sessionKeys&&(e.sessionKeys.ev_sid&&(g=e.sessionKeys.ev_sid),e.sessionKeys.ev_did&&(m=e.sessionKeys.ev_did)),"REQUIRE_LOGIN"===e.result&&(""!==o("ev_ss")&&t.Event.publish("session.cleanup","Session has expired"),t.Event.publish("login.required","Login is required")),"ALLOW_ACCESS"!=e.result&&t.Em.hideMeteredContent(),n(e)}else a&&a(C.status,C.responseText)},C.onerror=function(e){e?a(e):a(0,"unknown connection error")},C.send()},pretty_print:function(e){var n=/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/gm,o=JSON.stringify(e,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(n,t.Em.replacer);return o="<pre>"+o+"</pre>"},replacer:function(e,t,n,o,s){var r=t||"";return n&&(r=r+"<span class=json-key>"+n.replace(/[": ]/g,"")+"</span>: "),o&&(r=r+('"'==o[0]?"<span class=json-string>":"<span class=json-value>")+o+"</span>"),r+(s||"")},segment:function(n,o,s){t.Em.assert(n,"Parameters should not be empty!"),t.Em.assert(o,"Success callback should not be empty!"),t.Em.assert(s,"Error callback should not be empty!");var r=l(n),i=u("/segment",r),a=new XMLHttpRequest;a.open("GET",i,!0),a.withCredentials=!0,a.onload=function(){if(a.status>=200&&a.status<400){var e=JSON.parse(a.responseText);w.resolve(e),o(e)}else s&&s(a.status,a.responseText)},a.onerror=function(){e?s(e):s(0,"unknown connection error")},a.send()},assert:function(e,t){if(!e){if(t=t||"Assertion failed","undefined"!=typeof Error)throw new Error(t);throw t}},getUrl:function(){return f.url},showMeteredContent:function(){var e=document.getElementsByClassName("ev-meter-content");[].forEach.call(e,function(e){e.style.display="block"})},hideMeteredContent:function(){var e=document.getElementsByClassName("ev-meter-content");[].forEach.call(e,function(e){e.style.display="none"})}},setTimeout(function(){n()},4e3)}(window.EV);